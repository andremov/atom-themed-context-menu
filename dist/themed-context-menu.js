var f=Object.defineProperty;var g=s=>f(s,"__esModule",{value:!0});var I=(s,e)=>{for(var t in e)f(s,t,{get:e[t],enumerable:!0})};g(exports);I(exports,{TCMHandler:()=>c,activate:()=>v,deactivate:()=>x});var r;(function(s){s[s.Submenu=0]="Submenu",s[s.Separator=1]="Separator",s[s.Command=2]="Command"})(r||(r={}));function l(s,e){switch(e){case 0:return!!(s==null?void 0:s.submenu);case 1:return!!(s==null?void 0:s.type);case 2:return!!(s==null?void 0:s.command);default:return!1}}var C=class{constructor(e,t,n){this.selected=!1;this.navSubmenu=!1;this.hidden=!1;var a,u,o,d;this.itemData=t,this.height=23,this.parent=e,this.target=n;let i;if(t==null?void 0:t.type){i=document.createElement("div"),i.classList.add("menu-item");let m=document.createElement("div");m.classList.add("separator"),i.appendChild(m),this.height=7}if(!(t==null?void 0:t.type)){i=document.createElement("div"),i.classList.add("menu-item");let m=document.createElement("span");m.classList.add("menu-item-name"),m.innerHTML=(u=(a=t.id)!=null?a:t.label)!=null?u:"";let p=document.createElement("span");if(p.classList.add("menu-item-key"),t.command){let E=atom.keymaps.findKeyBindings({command:t.command});p.innerHTML=(d=(o=E[0])==null?void 0:o.keystrokes.toLocaleLowerCase())!=null?d:""}t.submenu!==void 0&&i.classList.add("has-submenu"),i.appendChild(m),i.appendChild(p)}this.domElement=i,this.domElement.addEventListener("click",m=>this.onMouseClick(m)),this.domElement.addEventListener("mouseenter",m=>this.onMouseEnter(m))}onMouseClick(e){e.stopPropagation(),this.callExecCommand()}callExecCommand(){var e;this.hasCommand()?(this.execCommand(),this.parent.deleteContextMenu()):this.itemData.submenu&&((e=this.submenu)==null||e.fireCommand())}hasCommand(){return this.itemData.command!==void 0}isSubmenu(){return!!this.itemData.submenu}onMouseEnter(e){this.isSeparator()||(e.stopPropagation(),this.select(),this.displaySubmenu())}createSubmenu(){let e=this.itemData.submenu;if(e&&!this.submenu){let t=this.domElement.getBoundingClientRect(),n={target:this.target,clientX:t.left+300,clientY:t.top,isSubmenu:!0};this.submenu=new h(n,e,!1)}}displaySubmenu(){var e;this.createSubmenu(),(e=this.submenu)==null||e.setVisible(!0)}select(){this.parent.unselectAll(),this.selected=!0,this.domElement.classList.add("selected")}unselect(){var e;this.selected=!1,this.domElement.classList.remove("selected"),(e=this.submenu)==null||e.setVisible(!1)}isSelected(){return this.selected}isNavigating(){return this.navSubmenu}isSeparator(){return l(this.itemData,r.Separator)}setNavigating(e){this.navSubmenu=e,e?this.submenuNavigate("Down"):(this.unselect(),this.select(),this.displaySubmenu())}hideElement(){this.hidden=!0,this.domElement.classList.add("not-search-result")}showElement(){this.hidden=!1,this.domElement.classList.remove("not-search-result")}submenuNavigate(e){var t;this.isSubmenu()&&((t=this.submenu)==null||t.navigate(e))}searchResult(e){var i,a,u;if(this.isSeparator())return!1;let t=this.itemData;if(t.submenu){if(((i=t.id)!=null?i:t.label).toLocaleLowerCase().includes(e.toLocaleLowerCase()))return!0;let o=t.submenu.filter(d=>{var m;return((m=d.id)!=null?m:d.label).toLocaleLowerCase().includes(e.toLocaleLowerCase())});return(a=this.submenu)==null||a.searchItem({target:{value:e}}),o.length>0}let n=this.itemData;return n.id||n.label?((u=n.id)!=null?u:n.label).toLocaleLowerCase().includes(e.toLocaleLowerCase()):!1}async execCommand(){var n;let e=this.target||((n=atom.workspace.getActiveTextEditor())==null?void 0:n.getElement())||atom.workspace.getActivePane().getElement(),t=this.itemData;await atom.commands.dispatch(e,t.command,t.commandDetail)}getElement(){return this.domElement}getHeight(){return this.height}};var h=class{constructor(e,t,n){this.itemData=[];this.items=[];this.visible=!0;if(this.itemData=t,this.hasSearchBox=!1,this.domElement=document.createElement("div"),this.domElement.classList.add("submenu"),!e.isSubmenu){let i=document.createElement("div");i.classList.add("context-menu-search-container");let a=document.createElement("input");a.type="search",a.id="context-menu-search-input",a.placeholder="Search",a.addEventListener("input",u=>this.searchItem(u)),a.addEventListener("keydown",u=>this.specialKeyHandle(u)),i.appendChild(a),this.domElement.appendChild(i),this.hasSearchBox=!0}if(n||(this.visible=!1,this.domElement.classList.add("invisible")),l(t[0],r.Separator)&&t.splice(0,1),l(t[t.length-1],r.Separator)&&t.splice(t.length-1,1),!e.isSubmenu){let i=t.filter(a=>{var u;return l(a,r.Command)&&((u=a.id)!=null?u:a.label).includes("Split")});t=t.filter(a=>{var u;return!l(a,r.Command)||l(a,r.Command)&&!((u=a.id)!=null?u:a.label).includes("Split")}),t.splice(9,0,{id:"Split Pane",submenu:i})}if(t.forEach(i=>{this.addItem(i,e.target)}),this.position=this.getPositionStyleString(e),this.domElement.setAttribute("style",`top: ${this.position.y}px; left: ${this.position.x}px;`),c.addContextMenu(this.domElement),!e.isSubmenu){let i=document.getElementById("context-menu-search-input");i==null||i.focus(),i==null||i.addEventListener("blur",()=>setTimeout(this.deleteContextMenu,100))}}unselectAll(){this.items.forEach(e=>e.unselect())}deleteContextMenu(){c.deleteContextMenu()}setVisible(e){this.visible=e,e?this.domElement.classList.remove("invisible"):(this.domElement.classList.add("invisible"),this.unselectAll())}getPositionStyleString(e){let t=Math.min(e.clientX+(e.isSubmenu?0:10),window.innerWidth-310),n=Math.min(e.clientY+(e.isSubmenu?0:5),window.innerHeight-this.getHeight()-10);return e.isSubmenu&&t===window.innerWidth-310&&e.clientX-600>=0&&(t=e.clientX-600),t=Math.max(0,t),n=Math.max(10,n),{x:t,y:n}}addItem(e,t){let n=new C(this,e,t);this.items.push(n),this.domElement.appendChild(n.getElement())}getHeight(){return this.items.length===0?0:this.items.map(e=>e.getHeight()).reduce(function(e,t){return e+t})+(this.hasSearchBox?40:0)}specialKeyHandle(e){switch(e.key){case"Escape":let t=document.getElementById("context-menu-search-input");t.value.length===0?this.deleteContextMenu():(t.value="",this.clearSearch());return;case"Enter":this.fireCommand();return;case"ArrowUp":this.navigate("Up");return;case"ArrowDown":this.navigate("Down");return;case"ArrowLeft":this.navigate("Left");return;case"ArrowRight":this.navigate("Right");return}}fireCommand(){var e;(e=this.items.find(t=>t.isSelected()))==null||e.callExecCommand()}navigate(e){var u;let t=this.items.findIndex(o=>o.isSelected()),n=this.items.length,i=window.innerWidth-this.position.x>610?"Right":"Left",a=["Left","Right"].filter(o=>o!==i)[0];if(t&&((u=this.items[t])==null?void 0:u.isSubmenu())){if(this.items[t].isNavigating())if(e===a){this.items[t].setNavigating(!1);return}else{this.items[t].submenuNavigate(e);return}else if(e===i){this.items[t].setNavigating(!0);return}}if(e==="Up"){let o=(n+(t!=null?t:n)-1)%n;for(;this.items[o].isSeparator();)o=(n+o-1)%n;this.items[o].select(),this.items[o].displaySubmenu();return}else if(e==="Down"){let o=(n+(t!=null?t:-1)+1)%n;for(;this.items[o].isSeparator();)o=(n+o+1)%n;this.items[o].select(),this.items[o].displaySubmenu();return}}clearSearch(){this.items.forEach(e=>e.showElement())}searchItem(e){let t=e.target.value;this.clearSearch(),this.items.filter(n=>!n.searchResult(t)).forEach(n=>n.hideElement())}};var M=class{constructor(){this.parentContainer=document.createElement("div"),this.parentContainer.classList.add("themed-context-menu");let e=document.querySelector("atom-workspace");e==null||e.appendChild(this.parentContainer)}hijackFunction(){let e=atom.contextMenu;this.hijackedFunction=e.showForEvent,e.showForEvent=t=>{let n=e.templateForEvent(t);this.displayContextMenu(t,n)}}releaseFunction(){let e=atom.contextMenu;e.showForEvent=this.hijackedFunction}displayContextMenu(e,t){var n;this.deleteContextMenu(),this.prevActiveElement=document.activeElement,(n=this.prevActiveElement)==null||n.blur(),t.length>0&&setTimeout(()=>this.activeMenu=new h(e,t,!0),110)}addContextMenu(e){this.parentContainer.appendChild(e)}deleteContextMenu(){var e;for(;this.parentContainer.firstChild;)this.parentContainer.removeChild(this.parentContainer.firstChild);(e=this.prevActiveElement)==null||e.focus()}};var c=new M,b=!1;atom.commands.add("atom-workspace",{"themed-context-menu:toggle-context-menu":()=>{b?x():v()}});function v(){c.hijackFunction(),b=!0}function x(){c.releaseFunction(),b=!1}
//# sourceMappingURL=themed-context-menu.js.map
