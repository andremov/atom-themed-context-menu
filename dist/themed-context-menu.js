var d=Object.defineProperty;var h=m=>d(m,"__esModule",{value:!0});var p=(m,e)=>{for(var t in e)d(m,t,{get:e[t],enumerable:!0})};h(exports);p(exports,{TCMHandler:()=>o,activate:()=>M,deactivate:()=>v});var l=class{constructor(e,t,n,i){this.selected=!1;this.element=e,this.parent=t,this.height=n,this.target=i,this.element.addEventListener("click",s=>this.onMouseClick(s)),this.element.addEventListener("mouseenter",s=>this.onMouseEnter(s))}static createMenuItem(e,t){if(e.type==="separator")return new l(document.createElement("hr"),t,7,null);let n=document.createElement("div");n.classList.add("menu-item");let i=new l(n,t,23,t.target),s=document.createElement("span");s.classList.add("menu-item-name"),s.innerHTML=e.label?e.label:"";let a=document.createElement("span");if(a.classList.add("menu-item-key"),n.appendChild(s),n.appendChild(a),e.command!==void 0){i.command=e.command,i.commandDetail=e.commandDetail;let r=atom.keymaps.findKeyBindings({command:e.command});r.length>0&&(a.innerHTML=r[r.length-1].keystrokes)}return e.submenu!==void 0&&(n.classList.add("has-submenu"),i.submenuItems=e.submenu),i}onMouseClick(e){e.stopPropagation(),this.hasCommand()&&(this.execCommand(),this.parent.deleteContextMenu())}hasCommand(){return this.command!==void 0}onMouseEnter(e){if(e.stopPropagation(),this.selected=!0,this.parent.unselectAll(),this.element.classList.add("selected"),this.submenuItems)if(this.submenu)this.submenu.setVisible(!0);else{let t=this.element.getBoundingClientRect(),n={...e,target:this.target,clientX:t.left+300,clientY:t.top,isSubmenu:!0};this.submenu=new u(n,this.submenuItems,!1),this.submenu.setVisible(!0)}}unselect(){var e;this.selected=!1,this.element.classList.remove("selected"),(e=this.submenu)==null||e.setVisible(!1)}async execCommand(){var t;if(!this.hasCommand())return;let e=this.target||((t=atom.workspace.getActiveTextEditor())==null?void 0:t.getElement())||atom.workspace.getActivePane().getElement();await atom.commands.dispatch(e,this.command,this.commandDetail)}getElement(){return this.element}getHeight(){return this.height}};var u=class{constructor(e,t,n){this.visible=!0;this.children=[];this.target=e.target,this.domElement=document.createElement("div"),this.domElement.classList.add("submenu"),n||(this.visible=!1,this.domElement.classList.add("invisible")),t.forEach(i=>{this.addItem(i)}),this.domElement.setAttribute("style",this.getPositionStyleString(e)),o.addMenu(this.domElement)}unselectAll(){this.children.forEach(e=>e.unselect())}deleteContextMenu(){o.deleteContextMenu()}setVisible(e){this.visible=e,e?this.domElement.classList.remove("invisible"):(this.domElement.classList.add("invisible"),this.unselectAll())}getPositionStyleString(e){let t=e.clientX+(e.isSubmenu?0:10),n=e.clientY+(e.isSubmenu?0:5),i=Math.min(t,window.innerWidth-310),s=Math.min(n,window.innerHeight-this.getHeight()-10);if(e.isSubmenu&&t!==i){let a=e.clientX-600,r=Math.max(a,0);a===r&&(i=a)}return i=Math.max(0,i),s=Math.max(10,s)/window.innerHeight*100,"top:"+s+"%; left:"+i+"px"}addItem(e){let t=l.createMenuItem(e,this);this.children.push(t),this.domElement.appendChild(t.getElement())}getHeight(){return this.children.length===0?0:this.children.map(e=>e.getHeight()).reduce(function(e,t){return e+t})}dispose(){o.removeMenu(this.domElement)}};var c=class{constructor(){this.container=document.createElement("div"),this.container.classList.add("themed-context-menu");let e=document.querySelector("atom-workspace");e==null||e.appendChild(this.container)}hijackFunction(){let e=atom.contextMenu;this.hijackedFunction=e.showForEvent,e.showForEvent=t=>{let n=e.templateForEvent(t);this.displayContextMenu(t,n)}}releaseFunction(){let e=atom.contextMenu;e.showForEvent=this.hijackedFunction}displayContextMenu(e,t){this.deleteContextMenu(),t.length>0&&new u(e,t,!0)}addMenu(e){this.container.appendChild(e)}removeMenu(e){this.container.removeChild(e)}onMouseClick(e){this.deleteContextMenu()}deleteContextMenu(){for(;this.container.firstChild;)this.container.removeChild(this.container.firstChild)}};var o=new c;function M(){o.hijackFunction()}function v(){o.releaseFunction()}
//# sourceMappingURL=themed-context-menu.js.map
